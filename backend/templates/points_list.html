{% extends 'base.html' %}

{% block title %}–¢–æ—á–∫–∏ –ü—É—Å—Ç–æ—à–µ–π{% endblock %}

{% block content %}
<h2 style="text-align: center; margin-bottom: 20px;">üìç –ó–ê–†–ï–ì–ò–°–¢–†–ò–†–û–í–ê–ù–ù–´–ï –¢–û–ß–ö–ò üìç</h2>

<div class="grid" id="points-grid">
    <p style="text-align: center; color: #00ff00;">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</p>
</div>

<div style="text-align: center; margin-top: 20px;">
    <button class="btn" id="prev-btn" onclick="loadPage(currentPage - 1)">‚óÑ –ù–ê–ó–ê–î</button>
    <span id="page-info" style="margin: 0 20px; color: #00ff00;"></span>
    <button class="btn" id="next-btn" onclick="loadPage(currentPage + 1)">–í–ü–ï–†–ï–î ‚ñ∫</button>
</div>
{% endblock %}

{% block extra_js %}
<script>
    let currentPage = 1;
    let totalPages = 1;

    async function loadPage(page) {
        try {
            const response = await fetch(`/api/points/?page=${page}`, {
                headers: {
                    'Authorization': 'Bearer ' + localStorage.getItem('access_token')
                }
            });
            const data = await response.json();
            
            currentPage = page;
            totalPages = Math.ceil(data.count / 20);
            
            const grid = document.getElementById('points-grid');
            grid.innerHTML = '';
            
            data.results.forEach(point => {
                const [lon, lat] = point.location.coordinates;
                grid.innerHTML += `
                    <div class="point-card">
                        <h3>${point.title}</h3>
                        <p>${point.description || '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è'}</p>
                        <p><strong>–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:</strong> ${lat.toFixed(4)}, ${lon.toFixed(4)}</p>
                        <p><strong>–í–ª–∞–¥–µ–ª–µ—Ü:</strong> ${point.owner_display_name || '–ù–µ–∏–∑–≤–µ—Å—Ç–µ–Ω'}</p>
                        ${point.owner_avatar ? `<img src="${point.owner_avatar}" class="avatar" alt="Avatar">` : ''}
                    </div>
                `;
            });
            
            document.getElementById('page-info').textContent = `–°—Ç—Ä–∞–Ω–∏—Ü–∞ ${currentPage} –∏–∑ ${totalPages}`;
            document.getElementById('prev-btn').disabled = currentPage === 1;
            document.getElementById('next-btn').disabled = currentPage === totalPages;
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
            document.getElementById('points-grid').innerHTML = '<p style="color: red;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</p>';
        }
    }

    loadPage(1);
</script>
{% endblock %}
